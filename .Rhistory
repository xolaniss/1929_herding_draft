library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
library(renv)
#| label: func
source(here("Functions","flextable_word.R" ))
source(here("Functions","modelsummary_pdf.R" ))
source(here("Functions","borderlines.R" ))
set_flextable_defaults(font.size = 7,
text.align = "left",
font.color = "black",
theme_fun = theme_apa,
padding = 0,
line_spacing = 0)
#| label: tbl-ols
#| tbl-cap: "Industry herding ols results"
#| cache: true
equation <-  as_equation(c("CSAD_{t} = \\gamma + \\gamma_1|R_{m, t}| +  \\gamma_2R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\gamma",
"\\gamma_1 ",
"\\gamma_2"
)
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding$models$ols_combined_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.", " ", " The regressions are based on ", equation), colwidths = 4) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.7)
#| label: fig-rol_gen
#| fig-cap: "Industry herding rolling regressions with 250 day window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_rol_gg <- general_herding$graphs$rol_gg
CSAD_model_rol_gg
#| label: tbl-ols_crisis
#| tbl-cap: "Industry herding in crisis periods"
#| cache: true
#| include: true
#| eval: true
equation <-  as_equation(c("CSAD_{t} = \\gamma + \\gamma_1D^{crisis}|R_{m, t}| + \\gamma_2(1-D^{crisis})|R_{m, t}| + \\gamma_3D^{crisis}R_{m, t}^2 +  \\gamma_4(1-D^{crisis})R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\gamma",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3 ",
"\\gamma_4"
)
CSAD_model_rol_crisis <- read_rds(here("Outputs", "artifacts_herding_crisis.rds"))
CSAD_model_rol_crisis_tbl <- CSAD_model_rol_crisis$models$combined_regression_tbl
CSAD_model_rol_crisis_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Crisis")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1."," ", " The regressions are based on ", equation), colwidths = 6) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
merge_at(i = 22) %>%
align(i = 22, align = "center") %>%
autofit(add_w = 0.1)
#| label: fig-rol_crisis_gd
#| fig-cap: "Industry herding during the Great Depression using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_rol_crisis$graphs$rol_gd_gg
#| label: fig-rol_crisis_db
#| fig-cap: "Industry herding during the Dot-com Bubble using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_rol_crisis$graphs$rol_db_gg
#| label: fig-rol_crisis_fc
#| fig-cap: "Industry herding during the Financial Crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_rol_crisis$graphs$rol_fc_gg
#| label: fig-rol_crisis_cv
#| fig-cap: "Industry herding during the Covid Crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_rol_crisis$graphs$rol_cv_gg
#| label: tbl-ols_fund
#| tbl-cap: "Industry herding on fundamental information"
#| cache: true
#| include: true
#| eval: true
equation_1 <-  as_equation(c("CSAD_{NONFUND, t} = \\gamma + \\gamma_1R_{m, t}| + \\gamma_2R_{m, t}^2 + \\epsilon_{t}"))
equation_2 <-  as_equation(c("CSAD_{FUND, t} = \\gamma + \\gamma_1R_{m, t}| + \\gamma_2R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\gamma",
"\\gamma_1 ",
"\\gamma_2"
)
CSAD_model_fundmamental <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
CSAD_model_fundamental_tbl <- CSAD_model_fundmamental$ols$ols_fund_tbl
CSAD_model_fundamental_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.", " ", " The regressions are based on ", equation_1, " and ", equation_2), colwidths = 4) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
autofit(add_w = 0.6)
#| label: fig-rol_fundamental
#| fig-cap: "Industry herding on fundamental information using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_fundmamental$ols_rol_graphs$rol_fundamental_gg
#| label: fig-rol_nonfundamental
#| fig-cap: "Industry herding on non-fundamental information using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
CSAD_model_fundmamental$ols_rol_graphs$rol_nonfundamental_gg
#| label: tbl-ols_crisis_fund
#| tbl-cap: "Industry herding on fundamental information in crisis periods"
#| cache: true
#| include: true
#| eval: true
equation <-  as_equation(c("CSAD_{FUND, t} = \\gamma + \\gamma_1D^{crisis}|R_{m, t}| + \\gamma_2(1-D^{crisis})|R_{m, t}| + \\gamma_3D^{crisis}R_{m, t}^2 +  \\gamma_4(1-D^{crisis})R_{m, t}^2 +  \\epsilon_{t}"))
equation_2 <-  as_equation(c("CSAD_{NONFUND, t} = \\gamma + \\gamma_1D^{crisis}|R_{m, t}| + \\gamma_2(1-D^{crisis})|R_{m, t}| + \\gamma_3D^{crisis}R_{m, t}^2 +  \\gamma_4(1-D^{crisis})R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\gamma",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3 ",
"\\gamma_4"
)
CSAD_model_rol_crisis_fund <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
CSAD_model_rol_crisis_fund_tbl <- CSAD_model_rol_crisis_fund$ols$ols_tbl
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Fund")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.", " ", " The regressions are based on ", equation, " and ", equation_2), colwidths = 6) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
merge_at(i = 22) %>%
align(i = 22, align = "center") %>%
merge_at(i = 29) %>%
align(i = 29, align = "center") %>%
merge_at(i = 36) %>%
align(i = 36, align = "center") %>%
merge_at(i = 43) %>%
align(i = 43, align = "center") %>%
merge_at(i = 50) %>%
align(i = 50, align = "center") %>%
autofit(add_w = 0.1)
#| label: fig-rol_fundamental_gd
#| fig-cap: "Industry herding on fundamental information during the Great depression using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
crisis_fundamental$fundamental$rol_fund_gd_gg
#| label: fig-rol_fundamental_db
#| fig-cap: "Industry herding on fundamental information during the Dot-com bubble using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$fundamental$rol_fund_db_gg
#| label: fig-rol_fundamental_fc
#| fig-cap: "Industry herding on fundamental information during the Financial crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$fundamental$rol_fund_fc_gg
#| label: fig-rol_fundamental_cv
#| fig-cap: "Industry herding on fundamental information during the Covid crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$fundamental$rol_fund_cv_gg
#| label: fig-rol_nonfundamental_gd
#| fig-cap: "Industry herding on non-fundamental information during the Great depression using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$nonfundamental$rol_nonfund_gd_gg
#| label: fig-rol_nonfundamental_db
#| fig-cap: "Industry herding on non-fundamental information during the Dot-com bubble using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$nonfundamental$rol_nonfund_db_gg
#| label: fig-rol_nonfundamental_fc
#| fig-cap: "Industry herding on non-fundamental information during the Financial crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$nonfundamental$rol_nonfund_fc_gg
#| label: fig-rol_nonfundamental_cv
#| fig-cap: "Industry herding on non-fundamental information during the Covid crisis using a 250-day rolling window. Note: The perforated lines represents a 5% level of significance."
#| fig-height: 4
#| fig-width: 8
#| cache: true
crisis_fundamental$nonfundamental$rol_nonfund_cv_gg
#| label: tbl-political
#| tbl-cap: "Herding and political cycles."
#| cache: true
equation_1 <-
as_equation(
c(
"Pr(D^{herd} = 1 | \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_2 <-
as_equation(
c(
"Pr(D^{herd}_{FUND} = 1 | \\lambda_0 + \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_3 <-
as_equation(
c(
"Pr(D^{herd}_{NONFUND} = 1 | \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
estimates <- c("\\lambda_0", "\\lambda_1", "\\lambda_2")
political <- read_rds(here("Outputs", "artifacts_party_dummy.rds"))
political$ols_party_dummy_model_tbl %>%
relocate(3, .before  = 2) %>%
ungroup() %>%
as_grouped_data(groups = c("Group")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_lines(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.",
" The regressions are based on ", equation_1,
" , ",
equation_2,
" and ",
equation_3)) %>%
hline_bottom(part = "footer",
border = fp_border(
color = "black",
style = "solid",
width = 1
)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.6)
#| label: fig-cons
#| fig-cap: "Consumables returns"
#| fig-height: 4
#| fig-width: 6
#| cache: true
returns_data <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
returns_data$graphs$Consumer_durables_nondurables_wholesale_retail_some_services_group_equal_gg
#| label: fig-health
#| fig-cap: "Health returns"
#| fig-height: 2
#| fig-width: 6
#| cache: true
returns_data$graphs$healthcare_medical_equipment_and_drugs_group_equal_gg
#| label: fig-manufacturing
#| fig-cap: "Manufacturing returns"
#| fig-height: 4
#| fig-width: 6
#| cache: true
returns_data$graphs$manufacturing_energy_utilities_group_equal_gg
#| label: fig-business
#| fig-cap: "Business services returns"
#| fig-height: 4
#| fig-width: 6
#| cache: true
returns_data$graphs$business_equipment_telephone_and_television_transmission_group_equal_gg
#| label: fig-mines
#| fig-cap: "Other returns"
#| fig-height: 6
#| fig-width: 8
#| cache: true
returns_data$graphs$mines_constr_bldmt_trans_hotels_bus_serv_entertainment_finance__group_equal_gg
#| label: tbl-grouping
#| tbl-cap: "Industry grouping using CRSP SICs"
#| tbl-colwidths: auto
#| cache: true
aggregation_scheme_tbl <- returns_data$full_data$aggregation_scheme_tbl
aggregation_scheme_tbl %>%
flextable() %>%
align(align = "left", part = "all") %>%
autofit(add_w = -0.1)
#| label: tbl-crises_description
#| tbl-cap: "Crises periods. Source: Wikipedia (2023)"
#| cache: true
crisis_tbl <-
tibble(
"Crisis" = c("Great Depression", "Dot-com Bubble", "Financial Crisis", "Covid Crisis"),
"Start" = c("1929-01-01", "1997-01-01", "2007-01-01", "2020-01-01"),
"End" = c("1939-12-31", "2003-12-31", "2009-12-31", "2021-12-31")
)
crisis_tbl %>%
flextable() %>%
align(j = 1, align = "left", part = "all") %>%
autofit(add_w = 1.5)
#| label: tbl-desc
#| tbl-cap: "Descriptive statistics"
#| cache: true
descriptives <- read_rds(here("Outputs", "artifacts_descriptives.rds"))
descriptives_tbl <-
descriptives$descriptives_tbl %>%
ungroup()
descriptives_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
align(align = "center", part = "all") %>%
align(align = "left", j = 1, part = "all") %>%
align(align = "left", j = 2, part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 12) %>%
align(i = 12, align = "center") %>%
merge_at(i = 23) %>%
align(i = 23, align = "center") %>%
merge_at(i = 34) %>%
align(i = 34, align = "center") %>%
merge_at(i = 45) %>%
align(i = 45, align = "center") %>%
merge_at(i = 56) %>%
align(i = 56, align = "center") %>%
autofit(add_w = 0.45)
#| label: fig-famafrench
#| fig-cap: "Fama-French Factors"
#| cache: true
famafrench <- read_rds(here("Outputs", "artifacts_fama_french.rds"))
famafrench$graphs$fama_french_gg
#| label: tbl-terms
#| tbl-cap: "Presidential terms"
#| cache: true
# importing presidential terms
presidential_terms <- read_rds(here("Outputs", "artifacts_presidential_terms.rds"))
presential_terms_tbl <-
presidential_terms$terms_tbl %>%
filter(Term_start >= "1920-01-01") %>%
rename(
"Start" = "Term_start",
"End" = "Term_end") %>%
mutate(
"Start" = lubridate::year(Start),
"End" = lubridate::year(End)
)
# creating table of presidential terms
presential_terms_tbl %>%
flextable() %>%
align(j = 1, align = "left", part = "all") %>%
colformat_double(j = 2:3, digits = 0, big.mark = "") %>%
autofit(add_w = 1.8)
#| label: fig-volatility
#| fig-cap: "Market volatility"
#| cache: true
#| fig-height: 2
volatility <- read_rds(here("Outputs", "artifacts_volatility.rds"))
volatility$graphs$volatility_gg
political$ols_party_dummy_model_tbl
political$ols_party_dummy_model_tbl %>%
relocate(3, .before  = 2)
political$probit_party_dummy_model_tbl
political$probit_party_dummy_model_tbl %>%
relocate(3, .before  = 2)
# Description
# Industry returns data cleaning by Xolani Sibande 17 September 2022
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
# Import -------------------------------------------------------------
equal_returns <-
read_csv(
here("Data", "49_Industry_Portfolios_Daily_equal.csv"),
skip = 1,
na = c("-99.99", "999")
) %>%
rename("Date" = ...1)
weighted_returns <-
read_csv(
here("Data", "49_Industry_Portfolios_Daily_weighted.csv"),
skip = 9,
na = c("-99.99", "999")
) %>%
rename("Date" = ...1)
names_vec <- as_vector(colnames(equal_returns))
replace_vec <- c(
"Agriculture" = "Agric",
"Food Products" = "Food",
"Candy and Soda" = "Soda",
"Beer and Liquor" = "Beer",
"Tobacco Products" = "Smoke",
"Recreation" = "Toys",
"Entertainment" = "Fun",
"Printing and Publishing" = "Books",
"Consumer Goods" = "Hshld",
"Apparel" = "Clths",
"Health Care" = "Hlth",
"Medical Equipment" = "MedEq",
"Chemicals" = "Chems",
"Rubber and Plastic Products" = "Rubbr",
"Textiles" = "Txtls",
"Construction Materials" = "BldMt",
"Construction" = "Cnstr",
"Steel Works" = "Steel",
"Fabricated Products" = "FabPr",
"Machinery" = "Mach",
"Electrical Equipment"  = "ElcEq",
"Automobiles and Trucks" = "Autos",
"Aircraft" = "Aero",
"Shipbuilding and Railroad Equipment" = "Ships",
"Defense" = "Guns",
"Precious Metals" = "Gold",
"Non-Metallic and Industrial Metal Mining" = "Mines",
"Petroleum and Natural Gas" = "Oil",
"Utilities" = "Util",
"Communication" = "Telcm",
"Personal Services" = "PerSv",
"Business Services" = "BusSv",
"Computers" = "Hardw",
"Software" = "Softw",
"Electronic Equipment" = "Chips",
"Measuring and Control Equipment" = "LabEq",
"Business Supplies" = "Paper",
"Shipping Containers" = "Boxes",
"Transportation" = "Trans",
"Wholesale" = "Whlsl",
"Retail" = "Rtail",
"Restaurants, Hotels, Motels" = "Meals",
"Banking" = "Banks",
"Insurance" = "Insur",
"Real Estate" = "RlEst",
"Trading" = "Fin"
)
equal_returns_tbl <-
equal_returns %>%
rename(replace_vec) %>%
mutate(Date = parse_date_time(Date, orders = "Ymd"))
equal_returns_tbl
equal_returns_tbl %>% skim()
