join_var = "Presidential Approval Rating")
ols_full_fundamental_tbl <-
par_fundamental_ols_tbl %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Fundamental Herding") %>%
ungroup()
## Non-fundamental herding --------------------------------------------------------
par_non_fundamental_ols_tbl <-
non_fundamental_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating"
)
ols_full_non_fundamental_tbl <-
par_non_fundamental_ols_tbl %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Non-fundamental Herding") %>%
ungroup()
## Combine --------------------------------------------------------
par_ols_tbl <-
bind_rows(
ols_full_tbl,
ols_full_fundamental_tbl,
ols_full_non_fundamental_tbl
)
par_ols_tbl
##  General herding --------------------------------------------------------
pear_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1981-04-01",
join_data = pear_daily_tbl,
join_var = "Presidential Economic Approval Rating")
formula <-  as.formula(`Presidential Economic Approval Rating` ~ a2)
ols_full_tbl <-
pear_general_ols_tbl %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
## Fundamental herding --------------------------------------------------------
pear_fundamental_ols_tbl <-
fundamental_herding_tbl %>%
clean_combine(
filter_date = "1981-04-01",
join_data = pear_daily_tbl,
join_var = "Presidential Economic Approval Rating")
ols_full_fundamental_tbl <-
pear_fundamental_ols_tbl %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Fundamental Herding") %>%
ungroup()
## Non-fundamental herding --------------------------------------------------------
pear_non_fundamental_ols_tbl <-
non_fundamental_herding_tbl %>%
clean_combine(
filter_date = "1981-04-01",
join_data = pear_daily_tbl,
join_var = "Presidential Economic Approval Rating"
)
ols_full_non_fundamental_tbl <-
pear_non_fundamental_ols_tbl %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Non-fundamental Herding") %>%
ungroup()
## Combine --------------------------------------------------------
pear_ols_tbl <-
bind_rows(
ols_full_tbl,
ols_full_fundamental_tbl,
ols_full_non_fundamental_tbl
)
# Export ---------------------------------------------------------------
artifacts_par_models <- list (
data = list(
par_general_ols_tbl = par_general_ols_tbl,
par_fundamental_ols_tbl = par_fundamental_ols_tbl,
par_non_fundamental_ols_tbl = par_non_fundamental_ols_tbl,
pear_general_ols_tbl = pear_general_ols_tbl,
pear_fundamental_ols_tbl = pear_fundamental_ols_tbl,
pear_non_fundamental_ols_tbl = pear_non_fundamental_ols_tbl
),
models = list(
par_ols_tbl = par_ols_tbl,
pear_ols_tbl = pear_ols_tbl
)
)
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
par_ols_tbl
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
pear_ols_tbl
par_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
approval <- read_rds(here("Outputs", "artifacts_par_models.rds"))
approval$models$par_ols_tbl %>%
relocate(3, .before  = 2)
approval$models$par_ols_tbl %>%
relocate(3, .before  = 2) %>%
ungroup() %>%
as_grouped_data(groups = c("Group")) %>%
as_flextable(hide_grouplabel = TRUE)
approval$models$par_ols_tbl %>%
relocate(3, .before  = 2) %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE)
par <- read_rds(here("Outputs", "artifacts_par_models.rds"))
par$models$par_ols_tbl
par$models$par_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE)
estimates <- c("\\theta_0", "\\theta0_1")
par <- read_rds(here("Outputs", "artifacts_par_models.rds"))
par$models$par_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3), part = "header", value = as_paragraph(as_equation(estimates)))
#| label: tbl-par
#| tbl-cap: "Herding and presidential approval ratings."
#| cache: true
equation_1 <-
as_equation(
c(
"Pr(D^{herd} = 1 | \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_2 <-
as_equation(
c(
"Pr(D^{herd}_{FUND} = 1 | \\lambda_0 + \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_3 <-
as_equation(
c(
"Pr(D^{herd}_{NONFUND} = 1 | \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
estimates <- c("\\theta_0", "\\theta0_1")
par <- read_rds(here("Outputs", "artifacts_par_models.rds"))
par$models$par_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_lines(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.",
" The regressions are based on ", equation_1,
" , ",
equation_2,
" and ",
equation_3)) %>%
hline_bottom(part = "footer",
border = fp_border(
color = "black",
style = "solid",
width = 1
)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.6)
#| label: tbl-pear
#| tbl-cap: "Herding and presidential economic approval ratings."
#| cache: true
equation_1 <-
as_equation(
c(
"Pr(D^{herd} = 1 | \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_2 <-
as_equation(
c(
"Pr(D^{herd}_{FUND} = 1 | \\lambda_0 + \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_3 <-
as_equation(
c(
"Pr(D^{herd}_{NONFUND} = 1 | \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
estimates <- c("\\theta_0", "\\theta0_1")
par$models$pear_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_lines(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.",
" The regressions are based on ", equation_1,
" , ",
equation_2,
" and ",
equation_3)) %>%
hline_bottom(part = "footer",
border = fp_border(
color = "black",
style = "solid",
width = 1
)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.6)
source("~/Papers/1929_herding_draft/Scripts/08_PAR.R")
pear_daily_tbl
par_daily_tbl
combined_gg
combined_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
par_ols_tbl
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
par_ols_tbl
pear_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
fx_plot()
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
tail(10)
par_general_ols_tbl
general_herding_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
geom_point() +
geom_hline(yintercept = 0, linetype = "dashed") +
scale_color_manual(values = c("red", "blue")) +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
geom_point() +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
facet_wrap(~Category, scales = "free_y") +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
clean_combine <- function(data, filter_date, join_data, join_var){
data %>%
dplyr::select(
-a0, -a1, -starts_with("t-statistic")
) %>%
pivot_wider(names_from = Category, values_from = a2) %>%
filter(Date >= ymd({{ filter_date }})) %>%
left_join(join_data, by = "Date") %>%
pivot_longer(
cols = -c(Date, join_var),
names_to = "Category",
values_to = "a2"
) %>%
relocate({{ join_var }}, .after = a2)
}
# Import -------------------------------------------------------------
par <- read_rds(here("Outputs", "artifacts_presidential_ratings.rds"))
par_daily_tbl <- par$data$par_daily_tbl
pear_daily_tbl <- par$data$pear_daily_tbl
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding_tbl <- general_herding$models$models_rol
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl
non_fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
facet_wrap(~Category, scales = "free_y") +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
par_general_ols_tbl
par_general_ols_tbl %>%
filter(a2 <= 0)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
formula <-  as.formula(a2 ~ `Presidential Approval Rating`)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
ols_full_tbl
# Description
# models with PAR and PEAR data - Xolani Sibande July 2024
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(midasr)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
clean_combine <- function(data, filter_date, join_data, join_var){
data %>%
dplyr::select(
-a0, -a1, -starts_with("t-statistic")
) %>%
pivot_wider(names_from = Category, values_from = a2) %>%
filter(Date >= ymd({{ filter_date }})) %>%
left_join(join_data, by = "Date") %>%
pivot_longer(
cols = -c(Date, join_var),
names_to = "Category",
values_to = "a2"
) %>%
relocate({{ join_var }}, .after = a2)
}
# Import -------------------------------------------------------------
par <- read_rds(here("Outputs", "artifacts_presidential_ratings.rds"))
par_daily_tbl <- par$data$par_daily_tbl
pear_daily_tbl <- par$data$pear_daily_tbl
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding_tbl <- general_herding$models$models_rol
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl
non_fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl
# PAR ols -----------------------------------------------------------------
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
formula <-  as.formula(a2 ~ `Presidential Approval Rating`)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
## Fundamental herding --------------------------------------------------------
par_fundamental_ols_tbl <-
fundamental_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
ols_full_fundamental_tbl <-
par_fundamental_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Fundamental Herding") %>%
ungroup()
## Non-fundamental herding --------------------------------------------------------
par_non_fundamental_ols_tbl <-
non_fundamental_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating"
)
ols_full_non_fundamental_tbl <-
par_non_fundamental_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Non-fundamental Herding") %>%
ungroup()
## Combine --------------------------------------------------------
par_ols_tbl <-
bind_rows(
ols_full_tbl,
ols_full_fundamental_tbl,
ols_full_non_fundamental_tbl
)
par_ols_tbl
par_non_fundamental_ols_tbl
par_non_fundamental_ols_tbl %>%
filter(a2 <= 0)
par_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
pear_ols_tbl
make
par_ols_tbl
