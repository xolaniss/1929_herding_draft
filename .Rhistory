dummy = dummy_crisis(
data_date = Date,
start_date = start,
end_date = end
),
anti_dummy = 1 - dummy
)
dummy_tbl %>% fx_plot()
# Combining data sets -----------------------------------------------------
combined_results_dummy_tbl <-
combined_results_tbl %>%
left_join(dummy_tbl, by = c("Date" = "Date")) %>%
mutate(squared_market_returns = `Market Return`^2,
absolute_market_returns = abs(`Market Return`),
dummy_abs = dummy*absolute_market_returns,
anti_dummy_abs = anti_dummy*absolute_market_returns,
dummy_squared = dummy*squared_market_returns,
anti_dummy_squared = anti_dummy*squared_market_returns)
combined_dummy_gg <-
combined_results_dummy_tbl %>%
ggplot(aes(x = Date, y = dummy, group = Category)) +
geom_line() +
facet_wrap( . ~ Category)
# Regressions ---------------------------------------------------------------
formula <- as.formula(
CSAD ~
dummy_abs +
anti_dummy_abs +
dummy_squared +
anti_dummy_squared
)
## OLS ---------------------------------------------------------------------
ols_tbl <-
combined_results_dummy_tbl %>%
ols_group_workflow() %>%
relocate(dummy_abs, .after = `(Intercept)`) %>%
relocate(dummy_squared, .before = anti_dummy_squared)
## QR ----------------------------------------------------------------------
qr_tbl <-
combined_results_dummy_tbl %>%
qmodels_group_workflow() %>%
relocate(dummy_abs, .after = `(Intercept)`) %>%
relocate(dummy_squared, .before = anti_dummy_squared)
## Rolling -----------------------------------------------------------------
models_rol <-
combined_results_dummy_tbl %>%
ols_slidify_models_crisis()
# Graphing ---------------------------------------------------------------
rol_gg <-
models_rol %>%
fx_recode_prep_crisis() %>%
fx_recode_group_plot(variables_color = 6, ncol = 5, nrow = 2)
rol_gg
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
rol_gg <-
models_rol %>%
fx_recode_prep_crisis() %>%
fx_recode_group_plot(variables_color = 6, ncol = 5, nrow = 2)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
# Graphing ---------------------------------------------------------------
rol_gg <-
models_rol %>%
fx_recode_prep_crisis() %>%
fx_recode_group_plot(variables_color = 6, ncol = 5, nrow = 2)
rol_gg
models_rol %>%
fx_recode_prep_crisis()
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
# Graphing ---------------------------------------------------------------
rol_gg <-
models_rol %>%
fx_recode_prep_crisis() %>%
fx_recode_group_plot(variables_color = 6, ncol = 5, nrow = 2)
rol_gg
source("~/Papers/1929_herding_draft/Scripts/general_herding_analysis.R")
source("~/Papers/1929_herding_draft/Scripts/herding_crisis_covid_analysis.R")
source("~/Papers/1929_herding_draft/Scripts/herding_crisis_gfc_analysis.R")
models_rol
rol_gg
source("~/Papers/1929_herding_draft/Scripts/herding_crisis_covid_analysis.R")
rol_gg
# Description
# Calculation of CSAD using weighted returns by Xolani Sibande 20 October 2022
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
# 0.0 Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "cross_deviations_functions.R"))
# 1.0 Import -------------------------------------------------------------
returns <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
equal_returns_tbl <- returns$full_data$equal_returns_tbl
fama_french <-  read_rds(here("Outputs", "artifacts_fama_french.rds"))
fama_french_tbl <- fama_french$data$fama_french_tbl
# 2.0 All industries ----------------------------------------------------------
# 2.1 Market return  ---------------------------------------------------------------
# fama_french_tbl <-
#   fama_french_tbl %>%
#   mutate(Mkt = `Mkt-RF` + RF)
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
# 2.3 Graphing ---------------------------------------------------------------
results_all_industries_gg <-
results_all_industries_tbl %>%
results_gg() +
labs(title = "All industries")
results_all_industries_gg
source("~/Papers/1929_herding_draft/Scripts/CSAD_CSSD.R")
results_all_gg
source("~/Papers/1929_herding_draft/Scripts/CSAD_CSSD.R")
results_all_gg
source("~/Papers/1929_herding_draft/Scripts/descriptives.R")
source("~/Papers/1929_herding_draft/Scripts/descriptives.R")
source("~/Papers/1929_herding_draft/Scripts/descriptives.R")
descriptives_tbl
#| label: setup
#| include: false
options(scipen=999)
knitr::opts_chunk$set(
fig.pos = "H",
fig.env= 'figure',
ft.align = "left",
ft.tabcolsep= 0,
ft.latex.float = "none",
ft.arraystretch = 0.4
)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
#| label: tbl-desc
#| tbl-cap: "Descriptive statistics"
#| cache: false
descriptives <- read_rds(here("Outputs", "artifacts_descriptives.rds"))
descriptives_tbl <- descriptives$descriptives_tbl
descriptives_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
align(align = "left", j = 1) %>%
merge_at(i = 1, j = 1:7) %>%
align(i = 1, align = "center") %>%
merge_at(i = 4, j = 1:7) %>%
align(i = 4, align = "center") %>%
merge_at(i = 7, j = 1:7) %>%
align(i = 7, align = "center") %>%
merge_at(i = 10, j = 1:7) %>%
align(i = 10, align = "center") %>%
merge_at(i = 13, j = 1:7) %>%
align(i = 13, align = "center") %>%
merge_at(i = 16, j = 1:7) %>%
align(i = 16, align = "center") %>%
autofit(add_w = 0.7)
source(here("Functions", "fx_plot.R"))
# Description
# Analysis on crisis periods - Xolani Sibande 14 June 2023
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(quantreg)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
source(here("Functions", "group_qr_functions.R"))
source(here("Functions", "group_ols_slidify_functions.R"))
dummy_crisis <- function(data_date, start_date, end_date){
ifelse(data_date > start_date & data_date < end_date, 1,0)
}
# Import -------------------------------------------------------------
result_csad_cssd <- read_rds(here("Outputs", "artifacts_descriptives.rds"))
combined_results_tbl <- result_csad_cssd$combined_results_tbl
combined_results_tbl
# Description
# Analysis on crisis periods - Xolani Sibande 14 June 2023
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(quantreg)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
source(here("Functions", "group_qr_functions.R"))
source(here("Functions", "group_ols_slidify_functions.R"))
dummy_crisis <- function(data_date, start_date, end_date){
ifelse(data_date > start_date & data_date < end_date, 1,0)
}
# Import -------------------------------------------------------------
result_csad_cssd <- read_rds(here("Outputs", "artifacts_descriptives.rds"))
combined_results_tbl <- result_csad_cssd$combined_results_tbl
# Dummies --------------------------------------------------------
## Financial Crisis --------------------------------------------------------
start <- as.Date("1929-10-1")
end <- as.Date("1954-11-31")
## Financial Crisis --------------------------------------------------------
start <- as.Date("1929-10-1")
end <- as.Date("1954-11-31")
end <- as.Date("1954-11-30")
dummy_tbl <- tibble(
Date  = seq(
from = as.Date("1926-07-01"),
to = as.Date("2022-07-29"),
by = "day"
),
dummy = dummy_crisis(
data_date = Date,
start_date = start,
end_date = end
),
anti_dummy = 1 - dummy
)
dummy_tbl %>% fx_plot()
# Combining data sets -----------------------------------------------------
combined_results_dummy_tbl <-
combined_results_tbl %>%
left_join(dummy_tbl, by = c("Date" = "Date")) %>%
mutate(squared_market_returns = `Market Return`^2,
absolute_market_returns = abs(`Market Return`),
dummy_abs = dummy*absolute_market_returns,
anti_dummy_abs = anti_dummy*absolute_market_returns,
dummy_squared = dummy*squared_market_returns,
anti_dummy_squared = anti_dummy*squared_market_returns)
combined_dummy_gg <-
combined_results_dummy_tbl %>%
ggplot(aes(x = Date, y = dummy, group = Category)) +
geom_line() +
facet_wrap( . ~ Category)
# Regressions ---------------------------------------------------------------
formula <- as.formula(
CSAD ~
dummy_abs +
anti_dummy_abs +
dummy_squared +
anti_dummy_squared
)
## OLS ---------------------------------------------------------------------
ols_tbl <-
combined_results_dummy_tbl %>%
ols_group_workflow() %>%
relocate(dummy_abs, .after = `(Intercept)`) %>%
relocate(dummy_squared, .before = anti_dummy_squared)
ols_tbl
qr_tbl <-
combined_results_dummy_tbl %>%
qmodels_group_workflow() %>%
relocate(dummy_abs, .after = `(Intercept)`) %>%
relocate(dummy_squared, .before = anti_dummy_squared)
qr_tbl
source("~/Papers/1929_herding_draft/Scripts/07_herding_gd_analysis.R")
#| label: setup
#| include: false
options(scipen=999)
knitr::opts_chunk$set(
fig.pos = "H",
fig.env= 'figure',
ft.align = "left",
ft.tabcolsep= 0,
ft.latex.float = "none",
ft.arraystretch = 0.4
)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
#| label: tbl-gd_ols
#| tbl-cap: "Herding during the Great Depression ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_gfc_crisis <- read_rds(here("Outputs", "artifacts_herding_gd_crisis.rds"))
herding_gfc_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-gd_qr
#| tbl-cap: "Herding during Great Depression quantile regressions"
#| ft.arraystretch: 0.4
herding_gd_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-gd_ols
#| tbl-cap: "Herding during the Great Depression ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_gd_crisis <- read_rds(here("Outputs", "artifacts_herding_gd_crisis.rds"))
herding_gd_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-gd_qr
#| tbl-cap: "Herding during Great Depression quantile regressions"
#| ft.arraystretch: 0.4
herding_gd_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol3
#| fig-cap: "Great Depression CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_gd_crisis$graphs$rol_gg
source("~/.active-rstudio-document", echo=TRUE)
source("~/Papers/1929_herding_draft/Scripts/09_herding_dot_com_analysis.R")
rol_gg
#| label: tbl-gd_dot
#| tbl-cap: "Herding during the Dot-com Bubble ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_dot_crisis <- read_rds(here("Outputs", "artifacts_herding_dot_crisis.rds"))
herding_dot_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-dot_qr
#| tbl-cap: "Herding during Great Depression quantile regressions"
#| ft.arraystretch: 0.4
herding_dot_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_dot
#| fig-cap: "Dot-com bubble CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_dot_crisis$graphs$rol_gg
