na = c("-99.99", "999")
) %>%
rename("Date" = ...1)
weighted_returns
# Cleaning -----------------------------------------------------------------
names_vec <- as_vector(colnames(equal_returns))
replace_vec <- c(
"Agriculture" = "Agric",
"Food Products" = "Food",
"Candy and Soda" = "Soda",
"Beer and Liquor" = "Beer",
"Tobacco Products" = "Smoke",
"Recreation" = "Toys",
"Entertainment" = "Fun",
"Printing and Publishing" = "Books",
"Consumer Goods" = "Hshld",
"Apparel" = "Clths",
"Health Care" = "Hlth",
"Medical Equipment" = "MedEq",
"Chemicals" = "Chems",
"Rubber and Plastic Products" = "Rubbr",
"Textiles" = "Txtls",
"Construction Materials" = "BldMt",
"Construction" = "Cnstr",
"Steel Works" = "Steel",
"Fabricated Products" = "FabPr",
"Machinery" = "Mach",
"Electrical Equipment"  = "ElcEq",
"Automobiles and Trucks" = "Autos",
"Aircraft" = "Aero",
"Shipbuilding and Railroad Equipment" = "Ships",
"Defense" = "Guns",
"Precious Metals" = "Gold",
"Non-Metallic and Industrial Metal Mining" = "Mines",
"Petroleum and Natural Gas" = "Oil",
"Utilities" = "Util",
"Communication" = "Telcm",
"Personal Services" = "PerSv",
"Business Services" = "BusSv",
"Computers" = "Hardw",
"Software" = "Softw",
"Electronic Equipment" = "Chips",
"Measuring and Control Equipment" = "LabEq",
"Business Supplies" = "Paper",
"Shipping Containers" = "Boxes",
"Transportation" = "Trans",
"Wholesale" = "Whlsl",
"Retail" = "Rtail",
"Restaurants, Hotels, Motels" = "Meals",
"Banking" = "Banks",
"Insurance" = "Insur",
"Real Estate" = "RlEst",
"Trading" = "Fin"
)
equal_returns_tbl <-
equal_returns %>%
rename(replace_vec) %>%
mutate(Date = parse_date_time(Date, orders = "Ymd"))
equal_returns_tbl
colnames(equal_returns_tbl)
# EDA --------------------------------------------------------
equal_returns_tbl %>%  skim()
# EDA --------------------------------------------------------
eda_tbl <- equal_returns_tbl %>%  skim()
str(eda_tbl)
glimpse(eda_tbl)
eda_tbl %>%
dplyr::select(-skim_type, -contains("POSIXct"))
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"))
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -Date, -contains("POSIXct"))
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"))
glimpse(eda_tbl)
eda_tbl
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct")) %>%
slice(-1)
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"), -numeric.hist) %>%
slice(-1)
glimpse(eda_tbl)
eda_tbl
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"), -numeric.hist) %>%
rename(
"Variable" = "skim_variable"
) %>%
slice(-1)
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"), -numeric.hist) %>%
rename(
"Variable" = "skim_variable",
"No. of missing" = "n_missing",
"Complete rate" = "complete_rate",
"Mean" = "numeric.mean",
"SD" = "numeric.sd",
"0th percentile" = "numeric.p0",
"25th percentile" = "numeric.p25",
"50th percentile" = "numeric.p50",
"100th percentile" = "numeric.p100"
) %>%
slice(-1)
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"), -numeric.hist) %>%
rename(
"Variable" = "skim_variable",
"No. of missing" = "n_missing",
"Complete rate" = "complete_rate",
"Mean" = "numeric.mean",
"Standard deviation" = "numeric.sd",
"0th percentile" = "numeric.p0",
"25th percentile" = "numeric.p25",
"50th percentile" = "numeric.p50",
"75th percentile" = "numeric.p75",
"100th percentile" = "numeric.p100"
) %>%
slice(-1)
glimpse(eda_tbl)
# EDA --------------------------------------------------------
eda_tbl <-
equal_returns_tbl %>%
skim() %>%
dplyr::select(-skim_type, -contains("POSIXct"), -numeric.hist) %>%
rename(
"Variable" = "skim_variable",
"No. of missing" = "n_missing",
"Complete rate" = "complete_rate",
"Mean" = "numeric.mean",
"Standard deviation" = "numeric.sd",
"0th percentile" = "numeric.p0",
"25th percentile" = "numeric.p25",
"50th percentile" = "numeric.p50",
"75th percentile" = "numeric.p75",
"100th percentile" = "numeric.p100"
) %>%
slice(-1)
source("~/Papers/1929_herding_draft/Scripts/00_returns.R")
#| label: setup
#| include: false
options(scipen=999)
knitr::opts_chunk$set(
fig.pos = "H",
fig.env= 'figure',
ft.align = "left",
ft.tabcolsep= 0,
ft.latex.float = "none",
ft.arraystretch = 0.4
)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
#| label: func
source(here("Functions","flextable_word.R" ))
source(here("Functions","modelsummary_pdf.R" ))
source(here("Functions","borderlines.R" ))
set_flextable_defaults(font.size = 7,
text.align = "left",
font.color = "black",
theme_fun = theme_apa,
padding = 0,
line_spacing = 0)
#| label: tbl-desc
#| tbl-cap: "Descriptive statistics"
#| cache: false
descriptives <- read_rds(here("Outputs", "artifacts_descriptives.rds"))
descriptives_tbl <- descriptives$descriptives_tbl
descriptives_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
align(align = "left", j = 1) %>%
merge_at(i = 1, j = 1:7) %>%
align(i = 1, align = "center") %>%
merge_at(i = 4, j = 1:7) %>%
align(i = 4, align = "center") %>%
merge_at(i = 7, j = 1:7) %>%
align(i = 7, align = "center") %>%
merge_at(i = 10, j = 1:7) %>%
align(i = 10, align = "center") %>%
merge_at(i = 13, j = 1:7) %>%
align(i = 13, align = "center") %>%
merge_at(i = 16, j = 1:7) %>%
align(i = 16, align = "center") %>%
autofit(add_w = 0.7)
#| label: fig-results-all
#| fig-cap: "Cross sectional deviations"
#| fig-height: 10
#| fig-width: 8
#| cache: false
cross_sectionals <- read_rds(here("Outputs", "artifacts_csad_cssd.rds"))
results_all_gg <- cross_sectionals$graphs$results_all_gg
results_all_gg
#| label: tbl-ols
#| tbl-cap: "General herding ols regression"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1|R_{m, t}| +  \\gamma_2R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2"
)
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 1) %>%
mk_par(i =, j = c(2, 3, 4), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 4) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-general_quantiles
#| tbl-cap: General herding quantile regressions
general_herding$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 1) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 4) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_gen
#| fig-cap: "CSAD rolling regressions with 250 day window"
#| fig-height: 6
#| fig-width: 8
#| cache: false
CSAD_model_rol_gg <- general_herding$graphs$rol_gg
CSAD_model_rol_gg
#| label: tbl-gd_ols
#| tbl-cap: "Herding during the Great Depression ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_gd_crisis <- read_rds(here("Outputs", "artifacts_herding_gd_crisis.rds"))
herding_gd_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-gd_qr
#| tbl-cap: "Herding during Great Depression quantile regressions"
#| ft.arraystretch: 0.4
herding_gd_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_gd
#| fig-cap: "Great Depression CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_gd_crisis$graphs$rol_gg
#| label: tbl-gd_dot
#| tbl-cap: "Herding during the Dot-com Bubble ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_dot_crisis <- read_rds(here("Outputs", "artifacts_herding_dot_crisis.rds"))
herding_dot_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-dot_qr
#| tbl-cap: "Herding during Dot-com Bubble quantile regressions"
#| ft.arraystretch: 0.4
herding_dot_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_dot
#| fig-cap: "Dot-com bubble CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_dot_crisis$graphs$rol_gg
#| label: tbl-gfs_ols
#| tbl-cap: "Herding during GFC ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_gfc_crisis <- read_rds(here("Outputs", "artifacts_herding_gfc_crisis.rds"))
herding_gfc_crisis$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-gfs_qr
#| tbl-cap: "Herding during GFC quantile regressions"
#| ft.arraystretch: 0.4
herding_gfc_crisis$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_gfc
#| fig-cap: "GFC CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_gfc_crisis$graphs$rol_gg
#| label: tbl-covid_ols
#| tbl-cap: "Herding during Covid crisis ols"
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| +
\\gamma_2 (1- D^{crisis})|R_{m, t}| +
\\gamma_3D^{crisis}R_{m, t}^2 + \\gamma_4(1-D^{crisis})R_{m, t}^2 + \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3",
"\\gamma_4"
)
herding_crisis_covid <- read_rds(here("Outputs", "artifacts_herding_covid_crisis.rds"))
herding_crisis_covid$models$ols_tbl %>%
add_column(.data = tibble(rep(" ", 6))) %>%
relocate(`rep(" ", 6)`, .after = Category) %>%
rename(" " = `rep(" ", 6)`) %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1,2,3,4, 5, 6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: tbl-covid_qr
#| tbl-cap: "Herding during Covid crisis quantile regressions"
#| ft.arraystretch: 0.4
herding_crisis_covid$models$qr_tbl %>%
as_grouped_data(groups = c("Category")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
autofit(add_w = 0) %>%
set_header_labels(
tau = " "
) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
width(j = c(1:6), width = 1) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
#| label: fig-rol_covid
#| fig-cap: "Covid CSAD rolling regressions with 250 day window"
#| fig-height: 5
#| fig-width: 8
#| cache: false
herding_crisis_covid$graphs$rol_gg
#| label: tbl-aggregation
#| tbl-cap: "Industry aggregation using the Fama-French factor scheme"
#| tbl-colwidths: auto
returns_data <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
aggregation_scheme_tbl <- returns_data$full_data$aggregation_scheme_tbl
aggregation_scheme_tbl %>%
flextable() %>%
align(align = "left", part = "all") %>%
autofit()
#| label: fig-cons-returns
#| fig-cap: "Consumables group returns"
#| fig-height: 6
#| fig-width: 6
#| cache: false
returns_data$graphs$Consumer_durables_nondurables_wholesale_retail_some_services_group_equal_gg
#| label: fig-health-returns
#| fig-cap: "Health group returns"
#| fig-height: 3
#| fig-width: 6
#| cache: false
returns_data$graphs$healthcare_medical_equipment_and_drugs_group_equal_gg
#| label: fig-manufacturing-returns
#| fig-cap: "Manufacturing group returns"
#| fig-height: 6
#| fig-width: 6
#| cache: false
returns_data$graphs$manufacturing_energy_utilities_group_equal_gg
#| label: fig-business-returns
#| fig-cap: "Business services group returns"
#| fig-height: 6
#| fig-width: 6
#| cache: false
returns_data$graphs$business_equipment_telephone_and_television_transmission_group_equal_gg
#| label: fig-mines-returns
#| fig-cap: "Mines group returns"
#| fig-height: 8
#| fig-width: 8
#| cache: true
returns_data$graphs$mines_constr_bldmt_trans_hotels_bus_serv_entertainment_finance__group_equal_gg
eda_tbl <- returns_data$full_data$eda_tbl
#| label: tbl-data_descriptives
#| tbl-cap: "Data Descriptive Statistics"
#| tbl-colwidths: auto
eda_tbl <- returns_data$full_data$eda_tbl
eda_tb %>%
flextable() %>%
align(align = "left", part = "all") %>%
autofit()
#| label: tbl-data_descriptives
#| tbl-cap: "Data Descriptive Statistics"
#| tbl-colwidths: auto
eda_tbl <- returns_data$full_data$eda_tbl
eda_tbl %>%
flextable() %>%
align(align = "left", part = "all") %>%
autofit()
source("~/Papers/1929_herding_draft/Scripts/00_returns.R")
