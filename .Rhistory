)
equation_2 <-
as_equation(
c(
"Pr(D^{herd}_{FUND} = 1 | \\lambda_0 + \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_3 <-
as_equation(
c(
"Pr(D^{herd}_{NONFUND} = 1 | \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
estimates <- c("\\theta_0", "\\theta0_1")
par <- read_rds(here("Outputs", "artifacts_par_models.rds"))
par$models$par_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_lines(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.",
" The regressions are based on ", equation_1,
" , ",
equation_2,
" and ",
equation_3)) %>%
hline_bottom(part = "footer",
border = fp_border(
color = "black",
style = "solid",
width = 1
)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.6)
#| label: tbl-pear
#| tbl-cap: "Herding and presidential economic approval ratings."
#| cache: true
equation_1 <-
as_equation(
c(
"Pr(D^{herd} = 1 | \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party}  + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_2 <-
as_equation(
c(
"Pr(D^{herd}_{FUND} = 1 | \\lambda_0 + \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
equation_3 <-
as_equation(
c(
"Pr(D^{herd}_{NONFUND} = 1 | \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}) = \\lambda_0 +  \\lambda_1D^{party} + \\lambda_2\\Gamma_{t}"
),
height = 0.05,
unit = "cm"
)
estimates <- c("\\theta_0", "\\theta0_1")
par$models$pear_ols_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Extreme")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_lines(values = as_paragraph("Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1.",
" The regressions are based on ", equation_1,
" , ",
equation_2,
" and ",
equation_3)) %>%
hline_bottom(part = "footer",
border = fp_border(
color = "black",
style = "solid",
width = 1
)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
autofit(add_w = 0.6)
source("~/Papers/1929_herding_draft/Scripts/08_PAR.R")
pear_daily_tbl
par_daily_tbl
combined_gg
combined_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
par_ols_tbl
pear_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
par_ols_tbl
pear_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
fx_plot()
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
tail(10)
par_general_ols_tbl
general_herding_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
geom_point() +
geom_hline(yintercept = 0, linetype = "dashed") +
scale_color_manual(values = c("red", "blue")) +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
geom_point() +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
facet_wrap(~Category, scales = "free_y") +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
clean_combine <- function(data, filter_date, join_data, join_var){
data %>%
dplyr::select(
-a0, -a1, -starts_with("t-statistic")
) %>%
pivot_wider(names_from = Category, values_from = a2) %>%
filter(Date >= ymd({{ filter_date }})) %>%
left_join(join_data, by = "Date") %>%
pivot_longer(
cols = -c(Date, join_var),
names_to = "Category",
values_to = "a2"
) %>%
relocate({{ join_var }}, .after = a2)
}
# Import -------------------------------------------------------------
par <- read_rds(here("Outputs", "artifacts_presidential_ratings.rds"))
par_daily_tbl <- par$data$par_daily_tbl
pear_daily_tbl <- par$data$pear_daily_tbl
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding_tbl <- general_herding$models$models_rol
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl
non_fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating") %>%
# plot with facet
ggplot(aes(x = Date, y = a2, color = Category)) +
geom_line() +
facet_wrap(~Category, scales = "free_y") +
geom_hline(yintercept = 0, linetype = "dashed") +
labs(
title = "General Herding",
x = "Date",
y = "a2"
)
par_general_ols_tbl
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
par_general_ols_tbl
par_general_ols_tbl %>%
filter(a2 <= 0)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
formula <-  as.formula(a2 ~ `Presidential Approval Rating`)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
ols_full_tbl
# Description
# models with PAR and PEAR data - Xolani Sibande July 2024
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(midasr)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
clean_combine <- function(data, filter_date, join_data, join_var){
data %>%
dplyr::select(
-a0, -a1, -starts_with("t-statistic")
) %>%
pivot_wider(names_from = Category, values_from = a2) %>%
filter(Date >= ymd({{ filter_date }})) %>%
left_join(join_data, by = "Date") %>%
pivot_longer(
cols = -c(Date, join_var),
names_to = "Category",
values_to = "a2"
) %>%
relocate({{ join_var }}, .after = a2)
}
# Import -------------------------------------------------------------
par <- read_rds(here("Outputs", "artifacts_presidential_ratings.rds"))
par_daily_tbl <- par$data$par_daily_tbl
pear_daily_tbl <- par$data$pear_daily_tbl
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
general_herding_tbl <- general_herding$models$models_rol
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl
non_fundamental_herding_tbl <- fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl
# PAR ols -----------------------------------------------------------------
## General herding --------------------------------------------------------
par_general_ols_tbl <-
general_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
formula <-  as.formula(a2 ~ `Presidential Approval Rating`)
ols_full_tbl <-
par_general_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "General Herding") %>%
ungroup()
## Fundamental herding --------------------------------------------------------
par_fundamental_ols_tbl <-
fundamental_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating")
ols_full_fundamental_tbl <-
par_fundamental_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Fundamental Herding") %>%
ungroup()
## Non-fundamental herding --------------------------------------------------------
par_non_fundamental_ols_tbl <-
non_fundamental_herding_tbl %>%
clean_combine(
filter_date = "1941-07-01",
join_data = par_daily_tbl,
join_var = "Presidential Approval Rating"
)
ols_full_non_fundamental_tbl <-
par_non_fundamental_ols_tbl %>%
filter(a2 <= 0) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Extreme = "Non-fundamental Herding") %>%
ungroup()
## Combine --------------------------------------------------------
par_ols_tbl <-
bind_rows(
ols_full_tbl,
ols_full_fundamental_tbl,
ols_full_non_fundamental_tbl
)
par_ols_tbl
par_non_fundamental_ols_tbl
par_non_fundamental_ols_tbl %>%
filter(a2 <= 0)
par_ols_tbl
source("~/Papers/1929_herding_draft/Scripts/12_par_models.R")
pear_ols_tbl
make
par_ols_tbl
#| label: setup
#| include: false
options(scipen=999)
knitr::opts_chunk$set(
fig.pos = "H",
fig.env= 'figure',
ft.align = "left",
ft.tabcolsep= 0,
ft.latex.float = "none",
ft.arraystretch = 0.4
)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
library(renv)
#| label: fig-approval
#| fig-cap: "Presidential approval ratings (Daily). "
#| cache: false
#| fig-height: 4
#| fig-width: 8
approval <- read_rds(here("Outputs", "artifacts_presidential_ratings.rds"))
approval_gg <- approval$graph$combined_gg
approval_gg
source("~/Papers/1929_herding_draft/Scripts/08_PAR.R")
combined_gg
combined_gg <-
combined_tbl %>% fx_plot(variables_color = 2) + labs(x = "Rating (%)")
combined_gg
?xlab
combined_gg <-
combined_tbl %>% fx_plot(variables_color = 2) + labs(y = "Rating (%)")
combined_gg
source("~/Papers/1929_herding_draft/Scripts/08_PAR.R")
combined_tbl
combined_tbl %>% skim()
pear_daily_tbl %>% skim()
mkdir("Latex")
mkdir(here("Latex"))
dir.create(here("Latex_version"))
# Packages -----------------------------------------------------------
library(here)
dir.create(here("Latex_version"))
?list.files
# Copy files ---------------------------------------------------------
list.files(path = ".", pattern = "tex", full.names = TRUE) %>%
file.copy(to = here("Latex_version"))
library(tidyverse)
# Copy files ---------------------------------------------------------
list.files(path = ".", pattern = "tex", full.names = TRUE) %>%
file.copy(to = here("Latex_version"))
# Copy files ---------------------------------------------------------
list.files(path = ".", pattern = ".tex", full.names = TRUE) %>%
file.copy(to = here("Latex_version"))
list.files(path = ".", pattern = "tex", full.names = TRUE)
# Copy files ---------------------------------------------------------
list.files(path = ".", pattern = "tex", full.names = TRUE) %>%
file.copy(to = here("Latex_version"))
# Copy resources folder ---------------------------------------------
dir.copy(here("1929_herding_draft_files"), here("Latex_version"))
library(fs)
# Copy resources folder ---------------------------------------------
dir.copy(here("1929_herding_draft_files"), here("Latex_version"))
# Copy resources folder ---------------------------------------------
dir_copy(here("1929_herding_draft_files"), here("Latex_version"))
?dir_copy
list.files(path = ".", pattern = "files", full.names = TRUE, recursive = TRUE)
list.files(path = ".", pattern = "_files", full.names = TRUE, recursive = TRUE)
list.files(path = ".", full.names = TRUE, recursive = TRUE)
list.dirs(path = ".", full.names = TRUE, recursive = TRUE)
?list.dirs
list.dirs(path = ".", pattern = "_files", full.names = TRUE)
list.dirs(path = ".", pattern = "^_files", full.names = TRUE)
list.dirs(path = ".", pattern = "$_files", full.names = TRUE)
list.dirs(path = ".", pattern = "files", full.names = TRUE)
list.dirs(path = ".", full.names = TRUE)
list.dirs(path = ".", full.names = TRUE) %>%
str_subset("files")
list.dirs(path = ".") %>%
str_subset("files")
list.dirs(path = ".", recursive = FALSE)
list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files")
# Copy resources folder ---------------------------------------------
list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files") %>%
dir_copy(here("Latex_version"), overwrite = TRUE))
# Copy resources folder ---------------------------------------------
list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files") %>%
dir_copy(here("Latex_version"), overwrite = TRUE)
# Description
# Generate folder to share latex version of the paper
# Packages -----------------------------------------------------------
library(here)
library(tidyverse)
library(fs)
# Create folder ------------------------------------------------------
dir.create(here("Latex_version"))
# Copy files ---------------------------------------------------------
list.files(path = ".", pattern = "tex", full.names = TRUE, ) %>%
file.copy(to = here("Latex_version"))
# Copy resources folder ---------------------------------------------
list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files") %>%
dir_copy(here("Latex_version"), overwrite = TRUE)
list.dirs(path = ".", recursive = FALSE)
list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files")
# Copy resources folder ---------------------------------------------
folder_path <- list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files") %>%
dir_copy(here("Latex_version", ), overwrite = TRUE)
# Copy resources folder ---------------------------------------------
folder_path <- list.dirs(path = ".", recursive = FALSE) %>%
str_subset("files")
folder_path
folder_name <- str_remove(folder_path, "./")
folder_name
source("~/Papers/1929_herding_draft/Scripts/08_PAR.R")
