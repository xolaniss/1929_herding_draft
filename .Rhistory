.names = "{.fn}"))
descriptives_tbl
# Description
# Calculation of CSAD using weighted returns by Xolani Sibande 20 October 2022
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
# 0.0 Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "cross_deviations_functions.R"))
# 1.0 Import -------------------------------------------------------------
returns <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
equal_returns_tbl <- returns$full_data$equal_returns_tbl
returns
equal_returns_tbl
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
results_all_industries_tbl
# 2.3 Graphing ---------------------------------------------------------------
results_all_industries_gg <-
results_all_industries_tbl %>%
results_gg() +
labs(title = "All industries")
results_all_industries_gg
equal_returns_tbl
?case_when
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = if_else(
Date = "1926-07-01", "first", Date
))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = if_else(
Date == "1926-07-01", "first", Date
))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = if_else(
Date == as.POSIXct("1926-07-01"), "first", Date
))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = if_else(
Date = as.POSIXct("1926-07-01"), "first", Date
))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = ifelse(
Date = as.POSIXct("1926-07-01"), "first", Date
))
as.POSIXct("1926-07-01")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = ifelse(
Date == as.POSIXct("1926-07-01"), "first", Date
))
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Crisis = ifelse(
Date == as.POSIXct("1926-07-01"), "first", Date
)) %>%
relocate(Crisis, .after = Date)
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.POSIXct(Date))
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.POSIXct(Date)) %>%
mutate(Crisis = ifelse(
Date == as.POSIXct("1926-07-01"), "first", Date
)) %>%
relocate(Crisis, .after = Date)
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.POSIXct(Date)) %>%
mutate(Crisis = if_else(
Date == as.POSIXct("1926-07-01"), "first", Date
)) %>%
relocate(Crisis, .after = Date)
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.POSIXct(Date)) %>%
mutate(Crisis = ifelse(
Date == as.POSIXct("1926-07-01"), "first", "Date"
)) %>%
relocate(Crisis, .after = Date)
equal_returns_tbl
as.POSIXct("1926-07-01"
as.POSIXct("1926-07-01")
as.POSIXct("1926-07-01")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date))
equal_returns_tbl
as.Date("1926-07-01")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis = ifelse(
Date == as.Date("1926-07-01"), "first", "Date"
)) %>%
relocate(Crisis, .after = Date)
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis = ifelse(
Date > as.Date("2007-09-9") | Date < as.Date("2009-03-31"), "Great Financial Crisis", "No Crisis"
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis = ifelse(
Date > as.Date("2007-09-09") | Date < as.Date("2009-03-31"), "Great Financial Crisis", "No Crisis"
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
equal_returns_tbl
as.Date("2007-09-09")
as.Date("2009-03-31")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis = ifelse(
Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis", "No Crisis"
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis = ifelse(
Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
equal_returns_tbl
unique(equal_returns_tbl$Crisis)
filter(equal_returns_tbl$Crisis == "Covid Crisis")
filter(equal_returns_tbl$Crisis == "Covid Crisis")
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Covid Crisis")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("1929-10-1") & Date < as.Date("1954-11-30"), "Great Financial Crisis",
ifelse(Date > as.Date("2000-04-1") & Date < as.Date("2002-12-31"), "Covid Crisis",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Covid Crisis")
equal_returns_tbl <-
returns$full_data$equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("1929-10-1") & Date < as.Date("1954-11-30"), "Great Depression",
ifelse(Date > as.Date("2000-04-1") & Date < as.Date("2002-12-31"), "Dot-com Bubble",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
is
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Covid Crisis")
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Great Financial Crisis")
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Great Depression Crisis")
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Great Depression")
filter(equal_returns_tbl, equal_returns_tbl$Crisis == "Dot-com Bubble")
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
equal_returns_tbl
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
equal_returns_tbl
equal_returns_tbl <-
returns$full_data$equal_returns_tbl
equal_returns_crisis_tbl <-
equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("1929-10-1") & Date < as.Date("1954-11-30"), "Great Depression",
ifelse(Date > as.Date("2000-04-1") & Date < as.Date("2002-12-31"), "Dot-com Bubble",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
results_all_industries_tbl
# 2.3 Graphing ---------------------------------------------------------------
results_all_industries_gg <-
results_all_industries_tbl %>%
results_gg() +
labs(title = "All industries")
results_all_industries_gg
equal_returns_crisis_tbl %>%
group_by(Crisis)
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl(data = .))
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map_dbl(data, ~cross_deviations_tbl(data = .))
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl(data = .))
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl())
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl)
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl(data = .))
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
# Description
# Calculation of CSAD using weighted returns by Xolani Sibande 20 October 2022
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
# 0.0 Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "cross_deviations_functions.R"))
# 1.0 Import -------------------------------------------------------------
returns <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl
equal_returns_crisis_tbl <-
equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("1929-10-1") & Date < as.Date("1954-11-30"), "Great Depression",
ifelse(Date > as.Date("2000-04-1") & Date < as.Date("2002-12-31"), "Dot-com Bubble",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
# fama_french <-  read_rds(here("Outputs", "artifacts_fama_french.rds"))
# fama_french_tbl <- fama_french$data$fama_french_tbl
# 2.0 All industries ----------------------------------------------------------
# 2.1 Market return  ---------------------------------------------------------------
# fama_french_tbl <-
#   fama_french_tbl %>%
#   mutate(Mkt = `Mkt-RF` + RF)
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
nested <- equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
nested$data
# Description
# Calculation of CSAD using weighted returns by Xolani Sibande 20 October 2022
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
# 0.0 Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "cross_deviations_functions.R"))
# 1.0 Import -------------------------------------------------------------
returns <- read_rds(here("Outputs", "artifacts_returns_data.rds"))
equal_returns_tbl <-
returns$full_data$equal_returns_tbl
equal_returns_crisis_tbl <-
equal_returns_tbl %>%
mutate(Date = as.Date(Date)) %>%
mutate(Crisis =
ifelse(Date > as.Date("1929-10-1") & Date < as.Date("1954-11-30"), "Great Depression",
ifelse(Date > as.Date("2000-04-1") & Date < as.Date("2002-12-31"), "Dot-com Bubble",
ifelse(Date > as.Date("2007-09-09") & Date < as.Date("2009-03-31"), "Great Financial Crisis",
ifelse(Date > as.Date("2020-3-09") & Date < as.Date("2020-12-31"), "Covid Crisis", "No Crisis")))
)) %>%
relocate(Crisis, .after = Date) # Adding crisis groups
# fama_french <-  read_rds(here("Outputs", "artifacts_fama_french.rds"))
# fama_french_tbl <- fama_french$data$fama_french_tbl
# 2.0 All industries ----------------------------------------------------------
# 2.1 Market return  ---------------------------------------------------------------
# fama_french_tbl <-
#   fama_french_tbl %>%
#   mutate(Mkt = `Mkt-RF` + RF)
# 2.2 CSAD and CSSD --------------------------------------------------------------------
results_all_industries_tbl <- cross_deviations_tbl(data = equal_returns_tbl)
# 2.3 Graphing ---------------------------------------------------------------
results_all_industries_gg <-
results_all_industries_tbl %>%
results_gg() +
labs(title = "All industries")
nested <- equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
nested <- equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
map(data, ~cross_deviations_tbl(data = .))
nested
nested <- equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest()
nested
nested <- equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .)))
nested
nested$deviations
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
group_by(Crisis) %>%
nest() %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .)))
results_all_industries_crisis_tbl$deviations
?nest
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .)))
results_all_industries_crisis_tbl$deviations
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest()
results_all_industries_crisis_tbl
glimpse(results_all_industries_crisis_tbl)
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest(cols = deviations)
glimpse(results_all_industries_crisis_tbl)
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest(cols = deviations, .drop = data)
glimpse(results_all_industries_crisis_tbl)
results_all_industries_crisis_tbl
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest(cols = deviations) %>%
drop(data)
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest(cols = deviations) %>%
dplyr::select(d-ata)
results_all_industries_crisis_tbl <-
equal_returns_crisis_tbl %>%
nest(.by = Crisis) %>%
mutate(deviations = map(data, ~cross_deviations_tbl(data = .))) %>%
unnest(cols = deviations) %>%
dplyr::select(-data)
results_all_industries_crisis_tbl
results_all_industries_crisis_tbl %>%
results_gg()
results_all_industries_crisis_tbl %>%
group_by(Crisis) %>%
results_gg()
results_all_industries_crisis_tbl %>%
nest(.by = Crisis) %>%
map(data, ~results_gg())
results_all_industries_crisis_tbl %>%
nest(.by = Crisis) %>%
map(data, ~results_gg(cross_deviations_tbl = .))
results_all_industries_crisis_tbl %>%
nest(.by = Crisis) %>%
map(data, ~results_gg(.))
results_all_industries_crisis_tbl %>%
nest(.by = Crisis) %>%
map(data, ~results_gg())
returns_consumables_group_tbl <-
returns$groups$Consumer_durables_nondurables_wholesale_retail_some_services_group_equal_tbl  # including some NAs in some categories %>%
results_all_industries_gg
results_all_industries_crisis_tbl
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date))
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date)) %>%
ggplot(aes(x = Date, y = value)) +
geom_line() +
facet_wrap(Crisis ~ name, scales = "free")
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date)) %>%
ggplot(aes(x = Date, y = value)) +
geom_line() +
facet_grid(Crisis ~ name, scales = "free")
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date)) %>%
ggplot(aes(x = Date, y = value)) +
geom_line() +
facet_grid(name ~ Crisis, scales = "free")
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date)) %>%
ggplot(aes(x = Date, y = value)) +
geom_line() +
facet_grid(name ~ Crisis, scales = "free_y")
results_all_industries_crisis_tbl %>%
pivot_longer(-c(Crisis, Date)) %>%
ggplot(aes(x = Date, y = value)) +
geom_line() +
facet_grid(name ~ Crisis, scales = "free")
