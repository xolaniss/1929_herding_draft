marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Business services")
# ggplot function glm probit model a2_nonfund_dummy on party_dummy
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "All industries")
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "Consumables")
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "Health")
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "Manufacturing")
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "Other")
dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, "Business services")
map(~ dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, .x)
# ggplot function glm probit model a2_nonfund_dummy on party_dummy
list("All industries",
list("All industries",
"Consumables",
"Health",
"Manufacturing",
"Other",
"Business services"
) %>%
map(~ dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, .x))
# Description
# Dummy on dummy regressions - November 2023 Xolani Sibande
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
library(magrittr)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(mfx)
library(margins)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_dummy_dummy.R"))
source(here("Functions", "group_dummy_dummy_slidify_functions.R"))
# Importing -------------------------------------------------------------
presidential <- read_rds(here("Outputs", "artifacts_presidential_terms.rds"))
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
# herding_crisis <- read_rds(here("Outputs", "artifacts_herding_crisis.rds"))
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
# fundamental_herding_crisis <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
# Cleaning -----------------------------------------------------------------
presidential_tbl <-
presidential$terms_daily_tbl %>%
filter(Date >= "1920-01-01") %>%
rename(
"party_dummy" = "Dummy"
)
presidential_tbl
# General herding estimation ----------------------------------------------
# selecting date and herding (a2)
general_herding_a2_tbl <-
general_herding$models$models_rol %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
general_herding_a2_tbl <-
general_herding_a2_tbl %>%
mutate(a2_dummy = ifelse(a2 < 0, 1, 0))
general_herding_a2_tbl
# merge general_herding_a2_tbl with presidential_tbl
general_herding_a2_presidential_tbl <-
general_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
general_herding_a2_presidential_tbl
# OLS of a2_dummy on party_dummy
formula <- as.formula(a2_dummy ~ party_dummy)
ols_a2_party_dummy_model_tbl<-
general_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "General Herding")
ols_a2_party_dummy_model_tbl
# Fundamental herding -----------------------------------------------------
# selection date and herding (a2)
fundamental_herding_a2_tbl <-
fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
fundamental_herding_a2_tbl <-
fundamental_herding_a2_tbl %>%
mutate(a2_fund_dummy = ifelse(a2 < 0, 1, 0))
# merge fundamental_herding_a2_tbl with presidential_tbl
fundamental_herding_a2_presidential_tbl <-
fundamental_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
# OLS of a2_fund_dummy on party_dummy
formula <- as.formula(a2_fund_dummy ~ party_dummy)
ols_a2_fund_party_dummy_model_tbl<-
fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Fundamental Herding")
ols_a2_fund_party_dummy_model_tbl
# Non-Fundamental herding  ----------------------------------------------------------
# selection date and herding (a2)
non_fundamental_herding_a2_tbl <-
fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
non_fundamental_herding_a2_tbl <-
non_fundamental_herding_a2_tbl %>%
mutate(a2_nonfund_dummy = ifelse(a2 < 0, 1, 0))
# merge non_fundamental_herding_a2_tbl with presidential_tbl
non_fundamental_herding_a2_presidential_tbl <-
non_fundamental_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
# OLS of a2_nonfund_dummy on party_dummy
formula <- as.formula(a2_nonfund_dummy ~ party_dummy)
ols_a2_nonfund_party_dummy_model_tbl<-
non_fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Non-Fundamental Herding")
ols_a2_nonfund_party_dummy_model_tbl
# Combined ----------------------------------------------------------------
# combine all the models
ols_party_dummy_model_tbl <-
bind_rows(
ols_a2_party_dummy_model_tbl,
ols_a2_fund_party_dummy_model_tbl,
ols_a2_nonfund_party_dummy_model_tbl
)
ols_party_dummy_model_tbl
# General herding - Probit ---------------------------------------------------------
# function to estimating glm probit model a2_dummy on party_dummy
# get the marginal effects
formula <-  as.formula(a2_dummy ~ party_dummy)
marginal_effect <-
function(data, category) {
glm(formula,
family = binomial(link = "probit"),
data =  data %>%  filter(Category == category)) %>%
margins::margins(data = data)
}
#  marginal effects for "All industries", "Consumables", "Health", "Manufacturing", "Other", "Business services"
marginal_effect(general_herding_a2_presidential_tbl, "All industries")
marginal_effect(general_herding_a2_presidential_tbl, "Consumables")
marginal_effect(general_herding_a2_presidential_tbl, "Health")
marginal_effect(general_herding_a2_presidential_tbl, "Manufacturing")
marginal_effect(general_herding_a2_presidential_tbl, "Other")
marginal_effect(general_herding_a2_presidential_tbl, "Business services")
# ggplot function glm probit model a2_dummy on party_dummy
dummy_dummy_gg <-
function(dep_var = a2_dummy, data = data, category = category) {
data %>%
filter(Category == {{ category }}) %>%
ggplot(aes(x = party_dummy,
y = {{ dep_var }})) +
geom_point() +
geom_smooth(
method = "glm",
method.args = list(family = binomial(link = "probit")),
se = FALSE) +
ggtitle( {{ category }})
}
dummy_dummy_gg(a2_dummy, general_herding_a2_presidential_tbl, "All industries")
dummy_dummy_gg(a2_dummy,general_herding_a2_presidential_tbl, "Consumables")
dummy_dummy_gg(a2_dummy,general_herding_a2_presidential_tbl, "Health")
dummy_dummy_gg(a2_dummy,general_herding_a2_presidential_tbl, "Manufacturing")
dummy_dummy_gg(a2_dummy,general_herding_a2_presidential_tbl, "Other")
dummy_dummy_gg(a2_dummy,general_herding_a2_presidential_tbl, "Business services")
# Probit - Fundamental herding  ---------------------------------------------------------
formula <- as.formula(a2_fund_dummy ~ party_dummy)
marginal_effect(fundamental_herding_a2_presidential_tbl, "All industries")
marginal_effect(fundamental_herding_a2_presidential_tbl, "Consumables")
marginal_effect(fundamental_herding_a2_presidential_tbl, "Health")
marginal_effect(fundamental_herding_a2_presidential_tbl, "Manufacturing")
marginal_effect(fundamental_herding_a2_presidential_tbl, "Other")
marginal_effect(fundamental_herding_a2_presidential_tbl, "Business services")
# ggplot function glm probit model a2_fund_dummy on party_dummy
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "All industries")
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "Consumables")
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "Health")
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "Manufacturing")
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "Other")
dummy_dummy_gg(a2_fund_dummy, fundamental_herding_a2_presidential_tbl, "Business services")
# Non-Fundamental herding - Probit ---------------------------------------------------------
formula <- as.formula(a2_nonfund_dummy ~ party_dummy)
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "All industries")
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Consumables")
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Health")
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Manufacturing")
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Other")
marginal_effect(non_fundamental_herding_a2_presidential_tbl, "Business services")
# ggplot function glm probit model a2_nonfund_dummy on party_dummy
list("All industries",
"Consumables",
"Health",
"Manufacturing",
"Other",
"Business services"
) %>%
map(~ dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, .x))
industry <- list("All industries",
"Consumables",
"Health",
"Manufacturing",
"Other",
"Business services"
)
# Description
# Dummy on dummy regressions - November 2023 Xolani Sibande
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
library(magrittr)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(mfx)
library(margins)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_dummy_dummy.R"))
source(here("Functions", "group_dummy_dummy_slidify_functions.R"))
# Importing -------------------------------------------------------------
presidential <- read_rds(here("Outputs", "artifacts_presidential_terms.rds"))
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
# herding_crisis <- read_rds(here("Outputs", "artifacts_herding_crisis.rds"))
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
# fundamental_herding_crisis <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
# Cleaning -----------------------------------------------------------------
presidential_tbl <-
presidential$terms_daily_tbl %>%
filter(Date >= "1920-01-01") %>%
rename(
"party_dummy" = "Dummy"
)
presidential_tbl
# General herding estimation ----------------------------------------------
# selecting date and herding (a2)
general_herding_a2_tbl <-
general_herding$models$models_rol %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
general_herding_a2_tbl <-
general_herding_a2_tbl %>%
mutate(a2_dummy = ifelse(a2 < 0, 1, 0))
general_herding_a2_tbl
# merge general_herding_a2_tbl with presidential_tbl
general_herding_a2_presidential_tbl <-
general_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
general_herding_a2_presidential_tbl
# OLS of a2_dummy on party_dummy
formula <- as.formula(a2_dummy ~ party_dummy)
ols_a2_party_dummy_model_tbl<-
general_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "General Herding")
ols_a2_party_dummy_model_tbl
# Fundamental herding -----------------------------------------------------
# selection date and herding (a2)
fundamental_herding_a2_tbl <-
fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
fundamental_herding_a2_tbl <-
fundamental_herding_a2_tbl %>%
mutate(a2_fund_dummy = ifelse(a2 < 0, 1, 0))
# merge fundamental_herding_a2_tbl with presidential_tbl
fundamental_herding_a2_presidential_tbl <-
fundamental_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
# OLS of a2_fund_dummy on party_dummy
formula <- as.formula(a2_fund_dummy ~ party_dummy)
ols_a2_fund_party_dummy_model_tbl<-
fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Fundamental Herding")
ols_a2_fund_party_dummy_model_tbl
# Non-Fundamental herding  ----------------------------------------------------------
# selection date and herding (a2)
non_fundamental_herding_a2_tbl <-
fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl %>%
dplyr::select(Date, Category, a2)
# creating a2 dummy
non_fundamental_herding_a2_tbl <-
non_fundamental_herding_a2_tbl %>%
mutate(a2_nonfund_dummy = ifelse(a2 < 0, 1, 0))
# merge non_fundamental_herding_a2_tbl with presidential_tbl
non_fundamental_herding_a2_presidential_tbl <-
non_fundamental_herding_a2_tbl %>%
left_join(presidential_tbl, by = c("Date" = "Date"))
# OLS of a2_nonfund_dummy on party_dummy
formula <- as.formula(a2_nonfund_dummy ~ party_dummy)
ols_a2_nonfund_party_dummy_model_tbl<-
non_fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Non-Fundamental Herding")
ols_a2_nonfund_party_dummy_model_tbl
# Combined ----------------------------------------------------------------
# combine all the models
ols_party_dummy_model_tbl <-
bind_rows(
ols_a2_party_dummy_model_tbl,
ols_a2_fund_party_dummy_model_tbl,
ols_a2_nonfund_party_dummy_model_tbl
)
ols_party_dummy_model_tbl
# General herding - Probit ---------------------------------------------------------
# function to estimating glm probit model a2_dummy on party_dummy
# get the marginal effects
formula <-  as.formula(a2_dummy ~ party_dummy)
marginal_effect <-
function(data, category) {
glm(formula,
family = binomial(link = "probit"),
data =  data %>%  filter(Category == category)) %>%
margins::margins(data = data)
}
industry <- list("All industries",
"Consumables",
"Health",
"Manufacturing",
"Other",
"Business services"
)
#  marginal effects for "All industries", "Consumables", "Health", "Manufacturing", "Other", "Business services"
industry %>%
map(marginal_effect, data = general_herding_a2_presidential_tbl, .x)
industry %>%
map(~marginal_effect(data = general_herding_a2_presidential_tbl, .x))
industry %>%
map(~dummy_dummy_gg(dep_var = a2_dummy, data = general_herding_a2_presidential_tbl, .x))
# ggplot function glm probit model a2_dummy on party_dummy
dummy_dummy_gg <-
function(dep_var = a2_dummy, data = data, category = category) {
data %>%
filter(Category == {{ category }}) %>%
ggplot(aes(x = party_dummy,
y = {{ dep_var }})) +
geom_point() +
geom_smooth(
method = "glm",
method.args = list(family = binomial(link = "probit")),
se = FALSE) +
ggtitle( {{ category }})
}
industry %>%
map(~dummy_dummy_gg(dep_var = a2_dummy, data = general_herding_a2_presidential_tbl, .x))
industry %>%
map(~marginal_effect(data = fundamental_herding_a2_presidential_tbl, .x))
# Probit - Fundamental herding  ---------------------------------------------------------
formula <- as.formula(a2_fund_dummy ~ party_dummy)
industry %>%
map(~marginal_effect(data = fundamental_herding_a2_presidential_tbl, .x))
# ggplot function glm probit model a2_fund_dummy on party_dummy
industry %>%
map(~dummy_dummy_gg(dep_var = a2_fund_dummy, data = fundamental_herding_a2_presidential_tbl, .x))
industry %>%
map(~marginal_effect(data = non_fundamental_herding_a2_presidential_tbl, .x))
# Non-Fundamental herding - Probit ---------------------------------------------------------
formula <- as.formula(a2_nonfund_dummy ~ party_dummy)
industry %>%
map(~marginal_effect(data = non_fundamental_herding_a2_presidential_tbl, .x))
industry %>%
map(~ dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, .x))
# Description
# Dummy on dummy regressions - November 2023 Xolani Sibande
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
library(magrittr)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
library(mfx)
library(margins)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_dummy_dummy.R"))
source(here("Functions", "group_dummy_dummy_slidify_functions.R"))
# Importing -------------------------------------------------------------
presidential <- read_rds(here("Outputs", "artifacts_presidential_terms.rds"))
general_herding <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
# herding_crisis <- read_rds(here("Outputs", "artifacts_herding_crisis.rds"))
fundamental_herding <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
# fundamental_herding_crisis <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
# Cleaning -----------------------------------------------------------------
presidential_tbl <-
presidential$terms_daily_tbl %>%
filter(Date >= "1920-01-01") %>%
rename(
"party_dummy" = "Dummy"
)
presidential_tbl
# General herding estimation ----------------------------------------------
# selecting date and herding (a2)
general_herding_a2_presidential_tbl <-
general_herding$models$models_rol %>%
dplyr::select(Date, Category, a2) %>%
# creating a2 dummy
mutate(a2_dummy = ifelse(a2 < 0, 1, 0)) %>%
# merge general_herding_a2_tbl with presidential_tbl
left_join(presidential_tbl, by = c("Date" = "Date"))
general_herding_a2_presidential_tbl
# Fundamental herding -----------------------------------------------------
# selection date and herding (a2)
fundamental_herding_a2_presidential_tbl <-
fundamental_herding$ols_rol$ols_full_fundamental_rol_tbl %>%
dplyr::select(Date, Category, a2) %>%
# creating a2 dummy
mutate(a2_fund_dummy = ifelse(a2 < 0, 1, 0)) %>%
# merge fundamental_herding_a2_tbl with presidential_tbl
left_join(presidential_tbl, by = c("Date" = "Date"))
fundamental_herding_a2_presidential_tbl
# OLS of a2_fund_dummy on party_dummy
formula <- as.formula(a2_fund_dummy ~ party_dummy)
ols_a2_fund_party_dummy_model_tbl<-
fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Fundamental Herding")
ols_a2_fund_party_dummy_model_tbl
# selection date and herding (a2)
non_fundamental_herding_a2_presidential_tbl <-
fundamental_herding$ols_rol$ols_full_nonfundamental_rol_tbl %>%
dplyr::select(Date, Category, a2) %>%
# creating a2 dummy
mutate(a2_nonfund_dummy = ifelse(a2 < 0, 1, 0)) %>%
# merge non_fundamental_herding_a2_tbl with presidential_tbl
left_join(presidential_tbl, by = c("Date" = "Date"))
# OLS of a2_nonfund_dummy on party_dummy
formula <- as.formula(a2_nonfund_dummy ~ party_dummy)
ols_a2_nonfund_party_dummy_model_tbl<-
non_fundamental_herding_a2_presidential_tbl %>%
dummy_dummy_full_workflow(formula = formula) %>%
mutate(Group = "Non-Fundamental Herding")
ols_a2_nonfund_party_dummy_model_tbl
# Combined ----------------------------------------------------------------
# combine all the models
ols_party_dummy_model_tbl <-
bind_rows(
ols_a2_party_dummy_model_tbl,
ols_a2_fund_party_dummy_model_tbl,
ols_a2_nonfund_party_dummy_model_tbl
)
source("~/Papers/1929_herding_draft/Scripts/10_dummy_on_dummy.R")
ols_party_dummy_model_tbl
industry %>%
map(~ dummy_dummy_gg(a2_nonfund_dummy, non_fundamental_herding_a2_presidential_tbl, .x))
