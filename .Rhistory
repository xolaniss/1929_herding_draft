rbind(
ols_gd_tbl %>% rename(dummy_abs = dummy_abs_gd,
anti_dummy_abs = anti_dummy_abs_gd,
dummy_squared = dummy_squared_gd,
anti_dummy_squared = anti_dummy_squared_gd
),
ols_db_tbl %>% rename(dummy_abs = dummy_abs_db,
anti_dummy_abs = anti_dummy_abs_db,
dummy_squared = dummy_squared_db,
anti_dummy_squared = anti_dummy_squared_db
),
ols_fc_tbl %>% rename(dummy_abs = dummy_abs_fc,
anti_dummy_abs = anti_dummy_abs_fc,
dummy_squared = dummy_squared_fc,
anti_dummy_squared = anti_dummy_squared_fc
),
ols_cv_tbl %>% rename(dummy_abs = dummy_abs_cv,
anti_dummy_abs = anti_dummy_abs_cv,
dummy_squared = dummy_squared_cv,
anti_dummy_squared = anti_dummy_squared_cv
)
) %>%
ungroup()
### Combining -----------------------------------------------------------
ols_tbl <-
rbind(
ols_gd_tbl %>% rename(dummy_abs = dummy_abs_gd,
anti_dummy_abs = anti_dummy_abs_gd,
dummy_squared = dummy_squared_gd,
anti_dummy_squared = anti_dummy_squared_gd
),
ols_db_tbl %>% rename(dummy_abs = dummy_abs_db,
anti_dummy_abs = anti_dummy_abs_db,
dummy_squared = dummy_squared_db,
anti_dummy_squared = anti_dummy_squared_db
),
ols_fc_tbl %>% rename(dummy_abs = dummy_abs_fc,
anti_dummy_abs = anti_dummy_abs_fc,
dummy_squared = dummy_squared_fc,
anti_dummy_squared = anti_dummy_squared_fc
),
ols_cv_tbl %>% rename(dummy_abs = dummy_abs_cv,
anti_dummy_abs = anti_dummy_abs_cv,
dummy_squared = dummy_squared_cv,
anti_dummy_squared = anti_dummy_squared_cv
)
) %>%
ungroup()
source("~/Papers/1929_herding_draft/Scripts/07_fundemental_herding_analysis_crisis.R")
#| label: setup
#| include: false
options(scipen=999)
knitr::opts_chunk$set(
fig.pos = "H",
fig.env= 'figure',
ft.align = "left",
ft.tabcolsep= 0,
ft.latex.float = "none",
ft.arraystretch = 0.4
)
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)
library(stargazer)
CSAD_model_rol_crisis_fund <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| + \\gamma_2(1-D^{crisis})|R_{m, t}| + \\gamma_3D^{crisis}R_{m, t}^2 +  \\gamma_4(1-D^{crisis})R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3 ",
"\\gamma_4"
)
CSAD_model_rol_crisis_fund <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
CSAD_model_rol_crisis_fund_tbl <- CSAD_model_rol_crisis_fund$ols$ols_tbl
CSAD_model_rol_crisis_fund_tbll %>%
ungroup() %>%
as_grouped_data(groups = c("Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry"))
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry"))
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Crisis", "Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry"))
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Crisis", "Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1))
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Crisis", "Herd")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
merge_at(i = 22) %>%
align(i = 22, align = "center") %>%
autofit(add_w = 0.1)
ols_fund_crisis <- function(data,
fund_formula = fund_formula,
non_fund_formula = non_fund_formula,
crisis = "Great Depression"){
formula <- fund_formula
fund_tbl <-
data %>%
ols_group_full_workflow(formula = formula) %>%
relocate(starts_with("dummy_abs"), .after = `(Intercept)`) %>%
relocate(starts_with("dummy_squared"), .before = starts_with("anti_dummy_squared")) %>%
mutate(Herd = "Fundamental", Crisis = crisis) %>%
mutate(Fund = paste(Crisis, ": ", Herd)) %>%
dplyr::select(-Herd, -Crisis)
formula <- non_fund_formula
non_fund_tbl <-
data %>%
ols_group_full_workflow(formula = formula) %>%
relocate(starts_with("dummy_abs"), .after = `(Intercept)`) %>%
relocate(starts_with("dummy_squared"), .before = starts_with("anti_dummy_squared")) %>%
mutate(Herd = "Non Fundamental", Crisis = crisis) %>%
mutate(Fund = paste(Crisis, ": ", Herd)) %>%
dplyr::select(-Herd, -Crisis)
rbind(fund_tbl, non_fund_tbl)
}
# Description
# Fundamental and non fundamental herding in time of crisis Xolani Sibande - 17 October 2023
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
source(here("Functions", "group_ols_slidify_functions.R"))
dummy_crisis <- function(data_date, start_date, end_date){
ifelse(data_date > start_date & data_date < end_date, 1,0)
}
ols_fund_crisis <- function(data,
fund_formula = fund_formula,
non_fund_formula = non_fund_formula,
crisis = "Great Depression"){
formula <- fund_formula
fund_tbl <-
data %>%
ols_group_full_workflow(formula = formula) %>%
relocate(starts_with("dummy_abs"), .after = `(Intercept)`) %>%
relocate(starts_with("dummy_squared"), .before = starts_with("anti_dummy_squared")) %>%
mutate(Herd = "Fundamental", Crisis = crisis) %>%
mutate(Fund = paste(Crisis, ": ", Herd)) %>%
dplyr::select(-Herd, -Crisis)
formula <- non_fund_formula
non_fund_tbl <-
data %>%
ols_group_full_workflow(formula = formula) %>%
relocate(starts_with("dummy_abs"), .after = `(Intercept)`) %>%
relocate(starts_with("dummy_squared"), .before = starts_with("anti_dummy_squared")) %>%
mutate(Herd = "Non Fundamental", Crisis = crisis) %>%
mutate(Fund = paste(Crisis, ": ", Herd)) %>%
dplyr::select(-Herd, -Crisis)
rbind(fund_tbl, non_fund_tbl)
}
# Import -------------------------------------------------------------
combined_fundamental <- read_rds(here("Outputs", "artifacts_fundamental_herding.rds"))
combined_fundamental_tbl <- combined_fundamental$ols$combined_fundamental_tbl
# EDA ---------------------------------------------------------------
combined_fundamental_tbl %>% skim()
# Dummies --------------------------------------------------------
start_gd <- as.Date("1929-01-01")
end_gd <- as.Date("1939-12-31")
start_db <- as.Date("1997-01-01")
end_db <- as.Date("2003-12-31")
start_fc <- as.Date("2007-01-01")
end_fc <- as.Date("2009-12-31")
start_cv <- as.Date("2020-01-01")
end_cv <- as.Date("2021-12-31")
dummy_tbl <- tibble(
Date  = seq(
from = as.Date("1926-07-01"),
to = as.Date("2022-07-29"),
by = "day"
),
dummy_gd = dummy_crisis(
data_date = Date,
start_date = start_gd,
end_date = end_gd
),
anti_dummy_gd = 1 - dummy_gd,
dummy_db = dummy_crisis(
data_date = Date,
start_date = start_db,
end_date = end_db
),
anti_dummy_db = 1 - dummy_db,
dummy_fc = dummy_crisis(
data_date = Date,
start_date = start_fc,
end_date = end_fc
),
anti_dummy_fc = 1 - dummy_fc,
dummy_cv = dummy_crisis(
data_date = Date,
start_date = start_cv,
end_date = end_cv
),
anti_dummy_cv = 1 - dummy_cv
)
dummy_tbl %>% fx_plot()
# Combining with Dummies --------------------------------------------------
combined_fundamental_dummy_tbl <-
combined_fundamental_tbl %>%
left_join(dummy_tbl, by = c("Date" = "Date")) %>%
mutate(
# Great Depression
squared_market_returns_gd = `Market Return`^2,
absolute_market_returns_gd = abs(`Market Return`),
dummy_abs_gd = dummy_gd*absolute_market_returns_gd,
anti_dummy_abs_gd = anti_dummy_gd*absolute_market_returns_gd,
dummy_squared_gd = dummy_gd*squared_market_returns_gd,
anti_dummy_squared_gd = anti_dummy_gd*squared_market_returns_gd,
# Dot-come bubble
squared_market_returns_db = `Market Return`^2,
absolute_market_returns_db = abs(`Market Return`),
dummy_abs_db = dummy_db*absolute_market_returns_db,
anti_dummy_abs_db = anti_dummy_db*absolute_market_returns_db,
dummy_squared_db = dummy_db*squared_market_returns_db,
anti_dummy_squared_db = anti_dummy_db*squared_market_returns_db,
# Financial Crisis
squared_market_returns_fc = `Market Return`^2,
absolute_market_returns_fc = abs(`Market Return`),
dummy_abs_fc = dummy_fc*absolute_market_returns_fc,
anti_dummy_abs_fc = anti_dummy_fc*absolute_market_returns_fc,
dummy_squared_fc = dummy_fc*squared_market_returns_fc,
anti_dummy_squared_fc = anti_dummy_fc*squared_market_returns_fc,
# Covid crisis
squared_market_returns_cv = `Market Return`^2,
absolute_market_returns_cv = abs(`Market Return`),
dummy_abs_cv = dummy_cv*absolute_market_returns_cv,
anti_dummy_abs_cv = anti_dummy_cv*absolute_market_returns_cv,
dummy_squared_cv = dummy_cv*squared_market_returns_cv,
anti_dummy_squared_cv = anti_dummy_cv*squared_market_returns_cv
)
# Regressions ---------------------------------------------------------------
## OLS ---------------------------------------------------------------------
### Great depression ----------------------------------------------------
fund_formula_gd <- as.formula(
CSAD_fund ~ dummy_abs_gd + anti_dummy_abs_gd + dummy_squared_gd + anti_dummy_squared_gd
)
non_fund_formula_gd <- as.formula(
CSAD_nonfund ~ dummy_abs_gd + anti_dummy_abs_gd + dummy_squared_gd + anti_dummy_squared_gd
)
ols_gd_tbl <-
combined_fundamental_dummy_tbl %>%
ols_fund_crisis(
fund_formula = fund_formula_gd,
non_fund_formula = non_fund_formula_gd)
### Dot-com Bubble ----------------------------------------------------
fund_formula_db <- as.formula(
CSAD_fund ~ dummy_abs_db + anti_dummy_abs_db + dummy_squared_db + anti_dummy_squared_db
)
non_fund_formula_db <- as.formula(
CSAD_nonfund ~ dummy_abs_db + anti_dummy_abs_db + dummy_squared_db + anti_dummy_squared_db
)
ols_db_tbl <-
combined_fundamental_dummy_tbl %>%
ols_fund_crisis(
fund_formula = fund_formula_db,
non_fund_formula = non_fund_formula_db,
crisis = "Dot-com Bubble")
### Financial Crisis -----------------------------------------------------
fund_formula_fc <- as.formula(
CSAD_fund ~ dummy_abs_fc + anti_dummy_abs_fc + dummy_squared_fc + anti_dummy_squared_fc
)
non_fund_formula_fc <- as.formula(
CSAD_nonfund ~ dummy_abs_fc + anti_dummy_abs_fc + dummy_squared_fc + anti_dummy_squared_fc
)
ols_fc_tbl <-
combined_fundamental_dummy_tbl %>%
ols_fund_crisis(
fund_formula = fund_formula_fc,
non_fund_formula = non_fund_formula_fc,
crisis = "Financial Crisis")
### Covid Crisis ---------------------------------------------------------
fund_formula_cv <- as.formula(
CSAD_fund ~ dummy_abs_cv + anti_dummy_abs_cv + dummy_squared_cv + anti_dummy_squared_cv
)
non_fund_formula_cv <- as.formula(
CSAD_nonfund ~ dummy_abs_cv + anti_dummy_abs_cv + dummy_squared_cv + anti_dummy_squared_cv
)
ols_cv_tbl <-
combined_fundamental_dummy_tbl %>%
ols_fund_crisis(
fund_formula = fund_formula_cv,
non_fund_formula = non_fund_formula_cv,
crisis = "Covid Crisis")
### Combining -----------------------------------------------------------
ols_tbl <-
rbind(
ols_gd_tbl %>% rename(dummy_abs = dummy_abs_gd,
anti_dummy_abs = anti_dummy_abs_gd,
dummy_squared = dummy_squared_gd,
anti_dummy_squared = anti_dummy_squared_gd
),
ols_db_tbl %>% rename(dummy_abs = dummy_abs_db,
anti_dummy_abs = anti_dummy_abs_db,
dummy_squared = dummy_squared_db,
anti_dummy_squared = anti_dummy_squared_db
),
ols_fc_tbl %>% rename(dummy_abs = dummy_abs_fc,
anti_dummy_abs = anti_dummy_abs_fc,
dummy_squared = dummy_squared_fc,
anti_dummy_squared = anti_dummy_squared_fc
),
ols_cv_tbl %>% rename(dummy_abs = dummy_abs_cv,
anti_dummy_abs = anti_dummy_abs_cv,
dummy_squared = dummy_squared_cv,
anti_dummy_squared = anti_dummy_squared_cv
)
) %>%
ungroup()
ols_tbl
source("~/Papers/1929_herding_draft/Scripts/07_fundemental_herding_analysis_crisis.R")
ols_tbl
#| label: tbl-ols_crisis_fund
#| tbl-cap: "Industry herding on fundamental information in crisis periods"
#| cache: false
#| include: true
#| eval: true
equation <-  as_equation(c("CSAD_{t} = \\alpha + \\gamma_1D^{crisis}|R_{m, t}| + \\gamma_2(1-D^{crisis})|R_{m, t}| + \\gamma_3D^{crisis}R_{m, t}^2 +  \\gamma_4(1-D^{crisis})R_{m, t}^2 +  \\epsilon_{t}"))
estimates <- c(
"\\alpha",
"\\gamma_1 ",
"\\gamma_2",
"\\gamma_3 ",
"\\gamma_4"
)
CSAD_model_rol_crisis_fund <- read_rds(here("Outputs", "artifacts_crisis_fundamental.rds"))
CSAD_model_rol_crisis_fund_tbl <- CSAD_model_rol_crisis_fund$ols$ols_tbl
CSAD_model_rol_crisis_fund_tbl %>%
ungroup() %>%
as_grouped_data(groups = c("Fund")) %>%
as_flextable(hide_grouplabel = TRUE) %>%
mk_par(i =, j = 1, part = "header", value = as_paragraph("Industry")) %>%
mk_par(i =, j = c(2, 3, 4, 5, 6), part = "header", value = as_paragraph(as_equation(estimates))) %>%
add_footer_row(values = as_paragraph("Note: The numbers in brackets are p-values. A p-value of less than 0.1 is significant", " ", ". The regressions are based on ", equation), colwidths = 6) %>%
hline_bottom(part = "footer", border = fp_border(color = "black", style = "solid", width = 1)) %>%
align(j = 1, align = "left", part = "all") %>%
merge_at(i = 1) %>%
align(i = 1, align = "center") %>%
merge_at(i = 8) %>%
align(i = 8, align = "center") %>%
merge_at(i = 15) %>%
align(i = 15, align = "center") %>%
merge_at(i = 22) %>%
align(i = 22, align = "center") %>%
autofit(add_w = 0.1)
source("~/Papers/1929_herding_draft/Scripts/07_fundemental_herding_analysis_crisis.R")
source("~/Papers/1929_herding_draft/Scripts/07_fundemental_herding_analysis_crisis.R")
source("~/Papers/1929_herding_draft/Scripts/06_fundemental_herding_analysis.R")
source("~/Papers/1929_herding_draft/Scripts/06_fundemental_herding_analysis.R")
source("~/Papers/1929_herding_draft/Scripts/06_fundemental_herding_analysis.R")
source("~/Papers/1929_herding_draft/Scripts/07_fundemental_herding_analysis_crisis.R")
source("~/Papers/1929_herding_draft/Scripts/06_fundemental_herding_analysis.R")
# Description
# Fundamental versus non fundamental herding Xolani Sibande - 13 October 2023
# Preliminaries -----------------------------------------------------------
# core
library(tidyverse)
library(readr)
library(readxl)
library(here)
library(lubridate)
library(xts)
library(broom)
library(glue)
library(scales)
library(kableExtra)
library(pins)
library(timetk)
library(uniqtag)
library(quantmod)
# graphs
library(PNWColors)
library(patchwork)
# eda
library(psych)
library(DataExplorer)
library(skimr)
# econometrics
library(tseries)
library(strucchange)
library(vars)
library(urca)
library(mFilter)
library(car)
options(scipen = 999)
# Functions ---------------------------------------------------------------
source(here("Functions", "fx_plot.R"))
source(here("Functions", "group_ols_functions.R"))
source(here("Functions", "group_ols_slidify_functions.R"))
# Import -------------------------------------------------------------
cross_sectionals <- read_rds(here("Outputs", "artifacts_general_herding.rds"))
CSAD_crisis_tbl <- cross_sectionals$data$combined_results_tbl
fama_french <- read_rds(here("Outputs", "artifacts_fama_french.rds"))
fama_french_tbl <- fama_french$data$fama_french_tbl
# Combining -----------------------------------------------------------------
combined_tbl <-
CSAD_crisis_tbl %>%
left_join(
fama_french_tbl,
by = c("Date" = "Date")
)
# EDA ---------------------------------------------------------------
combined_tbl %>% skim()
# Fundamental versus non fundamental equations --------------------------------
formula <- as.formula(CSAD ~ `Mkt-RF`+ RF + SMB + HML)
residuals_tbl <-
combined_tbl %>%
ols_nest_full_prep() %>%
mutate(models = map(data, ~ lm(formula, data = .))) %>%
mutate(models_residuals = map(models, ~ resid(.))) %>%
unnest(cols = models_residuals, names_repair = "universal") %>%
ungroup() %>%
dplyr::select(Category, models_residuals) %>%
mutate(Date = combined_tbl$Date) %>%
relocate(Date, .before = models_residuals)
# Re-combining ------------------------------------------------------------
combined_fundamental_tbl <-
combined_tbl %>%
left_join(residuals_tbl, by = c("Date" = "Date", "Category" = "Category")) %>%
rename("CSAD_nonfund" = models_residuals) %>%
mutate("CSAD_fund" = CSAD - CSAD_nonfund)
# Static OLS ------------------------------------------------------
## Fundamental -------------------------------------------------------------------
formula <-  as.formula(CSAD_fund ~ abs(`Market Return`) + I(`Market Return` ^ 2))
ols_full_fundamental_tbl <-
combined_fundamental_tbl %>%
dplyr::select(-Crisis) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Herd = "Fundamental") %>%
ungroup()
## Non Fundamental -------------------------------------------------------
formula <-  as.formula(CSAD_nonfund ~ abs(`Market Return`) + I(`Market Return` ^ 2))
ols_full_nonfundamental_tbl <-
combined_fundamental_tbl %>%
dplyr::select(-Crisis) %>%
ols_group_full_workflow(formula = formula) %>%
mutate(Herd = "Non Fundamental") %>%
ungroup()
## Combined ----------------------------------------------------------------
ols_fund_tbl <- rbind(ols_full_fundamental_tbl, ols_full_nonfundamental_tbl)
source("~/Papers/1929_herding_draft/Scripts/06_fundemental_herding_analysis.R")
